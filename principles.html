<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>usethis design principles • usethis</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script>


<!-- docsearch -->
<script src="docsearch.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous" />
<link href="docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>



<meta property="og:title" content="usethis design principles" />
<meta property="og:image" content="https://usethis.r-lib.org/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-title-body">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">usethis</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="articles/articles/usethis-setup.html">Setup</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="articles/articles/git-credentials.html">Managing Git(Hub) Credentials</a>
    </li>
    <li>
      <a href="articles/articles/pr-functions.html">Pull request helpers</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Blog posts</li>
    <li>
      <a href="https://www.tidyverse.org/blog/2020/12/usethis-2-0-0/">usethis 2.0.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/blog/2020/04/usethis-1-6-0/">usethis 1.6.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/blog/2019/04/usethis-1.5.0/">usethis 1.5.0 (and 1.4.0)</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/blog/2018/02/usethis-1-3-0/">usethis 1.3.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/blog/2017/11/usethis-1.0.0/">usethis 1.0.0 (and 1.1.0)</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="news/index.html">Change log</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-lib/usethis/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>usethis design principles</h1>
    </div>

<div id="usethis-design-principles" class="section level1">

<p><em>This is an experiment in making key package design principles explicit, versus only implicit in the code. The goal is to make maintenance easier, when spread out over time and across people.</em></p>
<div id="active-project" class="section level2">
<h2 class="hasAnchor">
<a href="#active-project" class="anchor"></a>Active project</h2>
<p>Many usethis functions act on the <strong>active project</strong>, the path to which is stored in the internal environment <code>proj</code>, specifically in <code>proj$cur</code>. We do this instead of constantly passing around a base path or relying on the working directory. It is implied that such functions create or modify files inside the active project. This is mostly true of <code>use_*()</code> functions, though there are exceptions. For example, <code><a href="reference/zip-utils.html">use_course()</a></code> makes no reference to the active project.</p>
<p>The project is activated upon first need, i.e. eventually some function calls <code><a href="reference/proj_utils.html">proj_get()</a></code> and, if <code>proj$cur</code> is <code>NULL</code>, we attempt to activate a project at (or above) current working directory.</p>
<p>Direct read/write of <code>proj$cur</code> should never happen, even internally. Instead, use <code><a href="reference/proj_utils.html">proj_get()</a></code> and <code><a href="reference/proj_utils.html">proj_set()</a></code>. If that is not possible (i.e. you don’t want to trigger project activation), use <code>proj_get_()</code> and <code>proj_set_()</code>. If one must use <code>proj_set_()</code> directly, remember the stored project path should be processed with <code>proj_path_prep()</code>.</p>
<p>Form paths to files within the project with <code><a href="reference/proj_utils.html">proj_path()</a></code>. Get paths relative to the project with <code>proj_rel_path()</code>.</p>
<div id="activation-upon-load-or-attach-no" class="section level3">
<h3 class="hasAnchor">
<a href="#activation-upon-load-or-attach-no" class="anchor"></a>Activation upon load or attach? No.</h3>
<p>We’ve contemplated project activation in <code><a href="https://rdrr.io/r/base/ns-hooks.html">.onLoad()</a></code> or <code><a href="https://rdrr.io/r/base/ns-hooks.html">.onAttach()</a></code>, but it’s not clear which is more appropriate. Which suggests that neither is appropriate. If we ever do this, <code>zzz.R</code> would include something like this:</p>
<pre class="{.r}"><code>.onLoad &lt;- function(libname, pkgname) {
  try(proj_set(".", quiet = TRUE), silent = TRUE)
}</code></pre>
<p>Why not <code><a href="https://rdrr.io/r/base/ns-hooks.html">.onAttach()</a></code>?</p>
<ul>
<li>A package that imported usethis would also need to set project on attach.</li>
<li>Currently user can open R, attach (or load) usethis, and then change working directory to their target project. As long as they are in the project the first time <code><a href="reference/proj_utils.html">proj_get()</a></code> is called, the correct project will be made active. This is not our preferred workflow, but it is common.</li>
</ul>
</div>
</div>
<div id="helper-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#helper-functions" class="anchor"></a>Helper functions</h2>
<p>With some ambivalence, internally-oriented helpers like <code><a href="reference/write-this.html">write_union()</a></code> are exported. This helps developers who are extending usethis to create a package to standardize project setup within their own organization.</p>
<p>The downside is that we aren’t exactly sure yet what we’re willing to guarantee about these helpers.</p>
<div id="permission-to-overwrite" class="section level3">
<h3 class="hasAnchor">
<a href="#permission-to-overwrite" class="anchor"></a>Permission to overwrite</h3>
<p><code><a href="reference/write-this.html">write_over()</a></code> returns <code>FALSE</code> and does nothing if there is no need to overwrite (proposed file contents are same as existing) or if user says “no” and returns <code>TRUE</code> if it ovewrites. So if downstream logic depends on whether something new was written, consult the return value. <code><a href="reference/write-this.html">write_over()</a></code> is rarely called directly, but is usually called via <code><a href="reference/use_template.html">use_template()</a></code>, in which case the same handling should apply to its return value.</p>
</div>
<div id="helpers-and-the-active-project" class="section level3">
<h3 class="hasAnchor">
<a href="#helpers-and-the-active-project" class="anchor"></a>Helpers and the active project</h3>
<p>Two opposing mindsets:</p>
<ul>
<li>Helpers should be low-level and general and <em>not</em> make direct use of the active project, nor change the active project (or activate on in the first place). I.e. project-based paths should be formed by the caller.</li>
<li>Everything should refer to the active project, unless there’s a specific reason not to.</li>
</ul>
<p>Ideally, the exported file writing helpers would not make direct reference to the active project. But we are violating this somewhat.</p>
<p><code>write_utf8()</code> potentially consults the project <code>path</code> lives in re: line ending. So its implementation takes care to respect that, but also to not change the active project.</p>
<p>Likewise, <code><a href="reference/write-this.html">write_union()</a></code> uses the active project, if such exists, to create a humane path in its message. It also actively avoids activating or changing the project.</p>
<p>Git/GitHub helpers generally assume we’re working on the Git repo that is also the active project. These are unexported. Prefer <code>git_repo()</code> to <code><a href="reference/proj_utils.html">proj_get()</a></code>, when you have a choice, to get the benefit of the <code>check_uses_git()</code> that’s in <code>git_repo()</code>.</p>
</div>
</div>
<div id="home-directory" class="section level2">
<h2 class="hasAnchor">
<a href="#home-directory" class="anchor"></a>Home directory</h2>
<p>usethis relies on fs for file system operations. The main thing users will notice is the treatment of home directory on Windows. A Windows user’s home directory is interpreted as <code>C:\Users\username</code> (typical of Unix-oriented tools, like Git and ssh; also matches Python), as opposed to <code>C:\Users\username\Documents</code> (R’s default on Windows). In order to be consistent everywhere, all paths supplied by the user should be processed with <code>user_path_prep()</code>.</p>
</div>
<div id="communicating-with-the-user" class="section level2">
<h2 class="hasAnchor">
<a href="#communicating-with-the-user" class="anchor"></a>Communicating with the user</h2>
<p>User-facing messages are emitted via helpers in <code>ui.R</code> and <em>everything</em> is eventually routed through <code><a href="https://rlang.r-lib.org/reference/abort.html">rlang::inform()</a></code> via <code>ui_inform()</code>. This is all intentional and should be preserved.</p>
<p>This is so we can control verbosity package-wide with the <code>usethis.quiet</code> option, which defaults to <code>FALSE</code>.</p>
<ul>
<li>Exploited in usethis tests: option is set and unset in <code>setup.R</code> and <code>teardown.R</code>. Eliminates the need for ubiquitous <code>capture_output()</code> calls.</li>
<li>Other packages can muffle a usethis call via, e.g., <code><a href="https://withr.r-lib.org/reference/with_options.html">withr::local_options(list(usethis.quiet = TRUE))</a></code>.</li>
<li>Use <code><a href="reference/ui.html">ui_silence()</a></code> is available for executing small bits of code silently.</li>
</ul>
</div>
<div id="gitgithub" class="section level2">
<h2 class="hasAnchor">
<a href="#gitgithub" class="anchor"></a>Git/GitHub</h2>
<p>Which GitHub remote configs the <code>pr_*()</code> functions accept, plus how and why they do it:</p>
<ul>
<li>
<code><a href="reference/pull-requests.html">pr_init()</a></code> calls <code>github_remote_config(github_get = NA)</code> and challenges configs other than “ours” and “fork”. I want it to work with the “maybe” configs, because sometimes you’re offline or don’t have your PAT in the credential store. These come up for me during development.</li>
<li>
<code><a href="reference/pull-requests.html">pr_resume()</a></code> only checks config (indirectly) if it calls <code>choose_branch()</code> I want to be able to use this function offline or in the absence of a PAT, since its main job is to switch branches. It seems inappropriate to do a hard check of the GitHub remote config.</li>
<li>
<code><a href="reference/pull-requests.html">pr_pause()</a></code> calls <code>target_repo(github_get = FALSE, ask = FALSE)</code> and will therefore accept “maybe” configs. Similar reasoning to <code><a href="reference/pull-requests.html">pr_resume()</a></code>: it seems like it should work, .e.g., offline, since it’s mostly about switching branches. Eventually calls <code>pr_pull_source_override()</code>.</li>
<li>
<code><a href="reference/pull-requests.html">pr_view()</a></code> gets target repo with <code>github_get = NA</code>, so it works for “maybe” configs. Seems low stakes enough to not be too picky.</li>
<li>
<code><a href="reference/pull-requests.html">pr_fetch()</a></code>, <code><a href="reference/pull-requests.html">pr_pull()</a></code>, <code><a href="reference/pull-requests.html">pr_merge_main()</a></code>, <code><a href="reference/pull-requests.html">pr_finish()</a></code>, all require “ours” or “fork”, via an early call to <code>target_repo(github_get = TRUE)</code> or <code>check_ours_or_fork()</code>. They could probably work for other configs, e.g., “theirs”, but it’s not worth the added complexity.</li>
<li>
<code><a href="reference/pull-requests.html">pr_push()</a></code> requires “ours” or “fork” and, in fact, gets the actual config, because it’s potentially used to select the remote to push to (<code>origin</code> or <code>upstream</code>) if user can push to both.</li>
</ul>
<p>When you need to create a new Git URL and have to decide between HTTPS or SSH:</p>
<ul>
<li>Consult existing remotes for the repo, probably <code>origin</code>, if possible</li>
<li>Call <code><a href="reference/git_protocol.html">git_protocol()</a></code>, which will do something sensible</li>
</ul>
<p>If the default summoning of Git credentials or GitHub PAT doesn’t work for the user, help them diagnose that. But we are NOT in the credential management business and we aren’t going to offer fine control of this at, say, the level of individual functions.</p>
<p>Functions that might make a commit should use <code>challenge_uncommitted_changes()</code> in the initial sanity-checking block to encourage starting in a clean state, i.e. with no uncommitted files or, if <code>untracked = TRUE</code> is specified, also with no untracked files. We allow people to proceed at their own risk.</p>
<p>Always make commits with <code>git_commit_ask()</code>. This why <code>git_commit()</code>, which wraps <code><a href="https://docs.ropensci.org/gert/reference/git_commit.html">gert::git_add()</a></code> and <code><a href="https://docs.ropensci.org/gert/reference/git_commit.html">gert::git_commit()</a></code>, is defined <em>inside</em> <code>git_commit_ask()</code>. Whenever possible, specify <code>paths</code> for <code>git_commit_ask()</code>. It should almost always be possible to know exactly which files we might have touched or created. If you need to make a commit in a noninteractive context, like a test, use <code><a href="https://docs.ropensci.org/gert/reference/git_commit.html">gert::git_commit()</a></code>.</p>
<p>Use <code>git_uncommitted(untracked = TRUE)</code> and <code>git_ask_commit(untracked = TRUE)</code> if it’s possible that the work we’ve done has <strong>created</strong> a new file that should be tracked. Use <code>untracked = FALSE</code> if our work should only modify and pre-existing file.</p>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>

</div>



      <footer>
      <div class="copyright">
  <p>Developed by <a href='http://hadley.nz'>Hadley Wickham</a>, <a href='https://jennybryan.org'>Jennifer Bryan</a>, <a href='https://www.rstudio.com'><img src='https://www.tidyverse.org/rstudio-logo.svg' alt='RStudio' height='24' /></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script>
<script>
  docsearch({
    
    
    apiKey: 'f67d4c46004acc8326e8d95f296a680e',
    indexName: 'usethis',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>



  </body>
</html>


